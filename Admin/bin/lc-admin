#!/usr/bin/env/ python

import cmd
import os
import commands
import time
import sys

import lc_admin.tools as tools

class Admin(cmd.Cmd):

	def __init__(self):
		cmd.Cmd.__init__(self)
		self.prompt = '(LC_ADMIN)> '
		
	def do_EOF(self, arg):
		return True
	
	def do_setro(self, arg):
		device_id, b = list(map(int, arg.split()))
		device = tools.Device(device_id)
		
		device.lock()
		os.system("echo %d > /sys/module/dm_lc/devices/%d/readonly" % (b, device_id))
		device.unlock()
		
	def help_setro(self):
		print("device_id bool")
		
	def do_quit(self, arg):
		sys.exit(1)
		
	do_q = do_quit

if __name__ == '__main__':
	admin = Admin()

	if len(sys.argv) > 1:
		admin.onecmd( ''.join(sys.argv[1:])  )
	else:	
		admin.cmdloop()
