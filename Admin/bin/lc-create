#!/usr/bin/env python

import os
import commands
from argparse import ArgumentParser

parser = ArgumentParser()

#parser.add_argument('--overwrite', help="overwrite the table of a existing dm device")

parser.add_argument('name')
parser.add_argument('device_id', type=int)
parser.add_argument('path')

args = parser.parse_args()

#if not args.overwrite:
print(args.path)
_size=commands.getoutput("blockdev --getsize %s" % (args.path))
print(_size)
size=int(_size)
os.system("dmsetup create %s --table \"0 %d lc %d %s 0\"" % 
		(args.name, size, args.device_id, args.path))
os.system("dmsetup message %s 0 add_sysfs" % (args.name));

#sys.exit("not support")

# TODO (overwrite)

# TODO (overwrite and no path. assuming linear)
# if not linear:
	# sys.exit('the device is not a linear device')	
