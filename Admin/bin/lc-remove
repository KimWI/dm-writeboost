#!/usr/bin/env python

import os
from argparse import ArgumentParser

import lc_admin.tools as tools

parser = ArgumentParser()
parser.add_argument('device_id', type=int)
args = parser.parse_args()

device_id = args.device_id
device = tools.Device(device_id)

# This line makes sure that
# this device is not bound to any cache.
os.system("lc-detach %d" % (device_id))

name = device.dm_name()
os.system("dmsetup message %s 0 remove_sysfs" % name)
os.system("dmsetup remove --retry %s" % name)
